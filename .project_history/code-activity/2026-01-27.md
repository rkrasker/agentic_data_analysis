# Code Activity Log: 2026-01-27

**Session:** Codex (GPT-5)
**Focus:** Fix difficulty-tier saturation + add realism imperfections + validate pipeline sample

---

## Summary

Implemented the Instruction 006 fixes for difficulty saturation and rendering realism:

1. **Path completeness tendency wired** into level selection with randomized, higher‑echelon‑biased dropping.
2. **Difficulty tier logic updated** to respect collision zones and structural resolvability (no universal any‑complete short‑circuit).
3. **Confounders made independent** with 15% rate.
4. **Imperfections applied** to rendered raw text (typos, abbreviation inconsistency, corrections, incomplete unit, column bleed).

Ran unit tests and a small pipeline sample; canonical.parquet produced and inspected.

---

## Files Modified

| File | Changes |
|------|---------|
| `src/synthetic/renderer.py` | Added tendency retention mapping, biased drop logic, and imperfection application helpers |
| `src/synthetic/difficulty_computer.py` | Replaced `_assign_tier` logic per Instruction 006 |
| `src/synthetic/vocabulary_injector.py` | Confounder gate independent; rate set to 0.15 |
| `tests/synthetic/test_difficulty_saturation_fix.py` | Added unit tests for tendency, tier logic, confounder independence, imperfections |

---

## Tests Run

```bash
PYTHONPATH=. /Users/Eli/.venvs/primary311/bin/pytest tests/synthetic/test_difficulty_saturation_fix.py
```

Result: **4 passed**

---

## Pipeline Sample Run

```bash
venv/bin/python -m src.synthetic.pipeline --output-dir data/synthetic --target-records 200 --seed 42
venv/bin/python -m src.preprocessing.preprocessing_adapter --input data/synthetic/raw.parquet --output data/synthetic/canonical.parquet
```

Generation stats (200 records):
- Total soldiers: 66
- Difficulty distribution: easy 48.5%, moderate 27.3%, hard 15.2%, extreme 9.1%

Note: Arrow emitted sysctl warnings about CPU flags (sandboxed env); no effect on outputs.

---

## Data Inspection

- Displayed canonical.parquet rows for soldiers `S0031` and `S0008`.
- Joined canonical records with raw quality tiers for `S0008`.
- Inspected validation.parquet states for `S0008`.

Observation: **records still appear too clean** compared to real‑world data; realism tuning remains a gap.

---

## Related Instructions

- Implemented: `instructions/active/006_fix-difficulty-saturation.md`

